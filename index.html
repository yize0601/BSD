<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å¹´é¾„è®¡ç®—å™¨ï¼ˆå®å² & è™šå²ï¼‰</title>

<style>
:root {
    --bg: #f9f9f9;
    --card: #ffffff;
    --text: #000000;
    --btn: #007bff;
    --btn-hover: #0056b3;
}

body.dark {
    --bg: #121212;
    --card: #1e1e1e;
    --text: #eaeaea;
    --btn: #4c8dff;
    --btn-hover: #2f6fff;
}

body {
    font-family: Arial, sans-serif;
    max-width: 600px;
    margin: 40px auto;
    padding: 20px;
    background: var(--bg);
    color: var(--text);
    transition: background 0.5s ease, color 0.5s ease;
}

h1 { text-align: center; }

label { display: block; margin: 15px 0 5px; font-weight: bold; }

input[type="date"] {
    width: 100%;
    padding: 10px;
    font-size: 16px;
    background: var(--card);
    color: var(--text);
    border: 1px solid #ccc;
    transition: background 0.5s, color 0.5s;
}

button {
    padding: 10px 20px;
    font-size: 16px;
    background: var(--btn);
    color: white;
    border: none;
    cursor: pointer;
    margin-top: 20px;
    transition: background 0.3s ease, transform 0.2s ease;
}

button:hover {
    background: var(--btn-hover);
    transform: translateY(-1px);
}

.result {
    margin-top: 30px;
    padding: 20px;
    background: var(--card);
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    transition: background 0.5s ease;
}

.result p { font-size: 18px; margin: 10px 0; }

/* æ¨¡å¼åˆ‡æ¢æŒ‰é’® */
.toggle {
    position: fixed;
    top: 15px;
    right: 15px;
    font-size: 22px;
    cursor: pointer;
    user-select: none;
    transition: transform 0.4s ease;
}

.toggle:hover {
    transform: rotate(20deg) scale(1.1);
}
</style>
</head>

<body>
<div class="toggle" onclick="toggleTheme()" id="themeIcon">ğŸŒ™</div>

<h1>å¹´é¾„è®¡ç®—å™¨ï¼ˆå®å² & è™šå²ï¼‰</h1>

<label for="birthdate">ä½ çš„å‡ºç”Ÿæ—¥æœŸï¼ˆå…¬å†ï¼‰ï¼š</label>
<input type="date" id="birthdate">
<button onclick="saveAndCalculate()">ä¿å­˜å¹¶è®¡ç®—</button>

<div class="result" id="result" style="display:none;">
    <p>å½“å‰å®å²ï¼ˆå‘¨å²ï¼‰ï¼š <strong id="realAge"></strong> å²</p>
    <p>å½“å‰è™šå²ï¼š <strong id="virtualAge"></strong> å²</p>
    <p>è·ç¦»ä¸‹ä¸€ä¸ªå®å²ç”Ÿæ—¥ï¼š <strong id="nextReal"></strong> å¤©</p>
    <p>è·ç¦»ä¸‹ä¸€ä¸ªè™šå²ï¼ˆä¸‹ä¸€ä¸ªæ˜¥èŠ‚ï¼‰ï¼š <strong id="nextVirtual"></strong> å¤©</p>
</div>

<script>
/* ===== é»‘æš—æ¨¡å¼ ===== */
function toggleTheme() {
    document.body.classList.toggle("dark");
    const dark = document.body.classList.contains("dark");
    localStorage.setItem("theme", dark ? "dark" : "light");
    document.getElementById("themeIcon").textContent = dark ? "â˜€ï¸" : "ğŸŒ™";
}

(function initTheme() {
    if (localStorage.getItem("theme") === "dark") {
        document.body.classList.add("dark");
        document.getElementById("themeIcon").textContent = "â˜€ï¸";
    }
})();

/* ===== åŸæœ‰å¹´é¾„é€»è¾‘ï¼ˆæœªæ”¹ï¼‰ ===== */
const chineseNewYear = {
    2025: "2025-01-29",
    2026: "2026-02-17",
    2027: "2027-02-06",
    2028: "2028-01-26",
    2029: "2029-02-13",
    2030: "2030-02-03"
};

function getNextChineseNewYear(today) {
    for (let y = today.getFullYear(); y <= today.getFullYear() + 5; y++) {
        if (chineseNewYear[y]) {
            const cny = new Date(chineseNewYear[y]);
            if (cny > today) return cny;
        }
    }
    return null;
}

function calculate() {
    const birthStr = localStorage.getItem("birthdate");
    if (!birthStr) return;
    const birth = new Date(birthStr);
    const today = new Date();
    today.setHours(0,0,0,0);

    let realAge = today.getFullYear() - birth.getFullYear();
    if (today < new Date(today.getFullYear(), birth.getMonth(), birth.getDate())) realAge--;

    let nextBirthday = new Date(today.getFullYear(), birth.getMonth(), birth.getDate());
    if (nextBirthday <= today) nextBirthday.setFullYear(today.getFullYear() + 1);
    const daysToNextReal = Math.ceil((nextBirthday - today) / 86400000);

    let virtualAge = today.getFullYear() - birth.getFullYear() + 1;
    const thisYearCNY = new Date(chineseNewYear[today.getFullYear()]);
    if (today < thisYearCNY) virtualAge--;

    const nextCNY = getNextChineseNewYear(today);
    const daysToNextVirtual = Math.ceil((nextCNY - today) / 86400000);

    document.getElementById("realAge").textContent = realAge;
    document.getElementById("virtualAge").textContent = virtualAge;
    document.getElementById("nextReal").textContent = daysToNextReal;
    document.getElementById("nextVirtual").textContent = daysToNextVirtual;
    document.getElementById("result").style.display = "block";
}

function saveAndCalculate() {
    const input = document.getElementById("birthdate").value;
    if (!input) return alert("è¯·é€‰æ‹©å‡ºç”Ÿæ—¥æœŸï¼");
    localStorage.setItem("birthdate", input);
    calculate();
}

window.onload = () => {
    const saved = localStorage.getItem("birthdate");
    if (saved) {
        document.getElementById("birthdate").value = saved;
        calculate();
    }
};
</script>
</body>
</html>